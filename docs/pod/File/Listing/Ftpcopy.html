<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>File::Listing::Ftpcopy</title>
    <script type="text/javascript" src="https://shjs.wdlabs.com/sh_main.min.js"></script>
    <script type="text/javascript" src="https://shjs.wdlabs.com/lang/sh_perl.min.js"></script>
    <link type="text/css" rel="stylesheet" href="https://shjs.wdlabs.com/css/sh_acid.css">
    <link type="text/css" rel="stylesheet" href="/css/default.css">
  </head>
  <body onload="sh_highlightDocument();">
    <div class="nx-header-flag-1"></div>
    <div class="nx-header-flag-2"></div>
    <div class="nx-header-title"><a href="/">ðŸŒ»</a> <a href="/pod/">ðŸ“–</a> File::<a href="https://alienfile.org/pod/File/Listing.html">Listing</a>::Ftpcopy</div>
    <!--File::Listing::Ftpcopy--><a name='___top' class='dummyTopAnchor' ></a>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#VERSION'>VERSION</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS'>FUNCTIONS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#parse_dir'>parse_dir</a>
    <li class='indexItem indexItem2'><a href='#ftpparse'>ftpparse</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#CAVEATS'>CAVEATS</a>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#COPYRIGHT_AND_LICENSE'>COPYRIGHT AND LICENSE</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>File::Listing::Ftpcopy - parse directory listing using ftpparse from ftpcopy</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="VERSION"
>VERSION</a></h1>

<p>version 0.09</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre class="sh_perl"> # traditional interface
 use File::Listing::Ftpcopy qw(parse_dir);
 $ENV{LANG} = &#34;C&#34;;  # dates in non-English locales not supported
 for (parse_dir(`ls -l`)) {
     ($name, $type, $size, $mtime, $mode) = @$_;
     next if $type ne &#39;f&#39;; # plain file
     #...
 }

 # directory listing can also be read from a file
 open(LISTING, &#34;zcat ls-lR.gz|&#34;);
 $dir = parse_dir(\*LISTING, &#39;+0000&#39;);

 # ftpparse interface
 use 5.010;
 use Parse::Listing::Ftpcopy qw( ftpparse SIZE_UNKNOWN );
 
 foreach my $line (`ls -l`)
 {
   chomp $line;
   my $h = ftpparse($line);
   next unless defined $h;
   say &#34;name : &#34;, $h-&#62;{name}
   say &#34;size : &#34;, $h-&#62;{size} if $h-&#62;{sizetype} != SIZE_UNKNOWN;
 }</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This module provides functions for parsing the output of directory listings of the sort generated by an FTP server. It is intended to provide a mostly drop in replacement for the <code>parse_dir</code> function from <a href="https://alienfile.org/pod/File/Listing.html" class="podlinkpod"
>File::Listing</a> (although see CAVEATS below) that uses the <code>ftpparse</code> function from <code>ftpcopy</code> (see URL in the SEE ALSO section below) instead of the Perl implementation provided by <a href="https://alienfile.org/pod/File/Listing.html" class="podlinkpod"
>File::Listing</a>. <code>ftpparse</code> is written in C, and so may or may not be faster, although probably unnoticeable unless you are parsing a recursive directory listing of a large system, and if you have to do that maybe you should rethink your approach anyway.</p>

<p>Where this module may come in handy over <a href="https://alienfile.org/pod/File/Listing.html" class="podlinkpod"
>File::Listing</a> is that it understands the output from a different subset of systems. For my purposes, <code>ftpparse</code> understands VMS listings, on the other hand, <a href="https://alienfile.org/pod/File/Listing.html" class="podlinkpod"
>File::Listing</a> understands Apache listings, neither module understands both. If you know ahead of time which system you are going to be dealing with you can use either this module or <a href="https://alienfile.org/pod/File/Listing.html" class="podlinkpod"
>File::Listing</a>, or if you do not know ahead of time, you can try each and use the results from which ever one actually works (or works best).</p>

<p>This module supports the following file listings:</p>

<ul>
<li>EPLF</li>

<li>UNIX ls, with or without gid</li>

<li>Different Windows and DOS FTP servers.</li>

<li>VMS, but not CMS</li>

<li>NetPresenz (Mac)</li>

<li>NetWare</li>
</ul>

<p>This module also provides a direct interface to the <code>ftpparse</code> function as well.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS"
>FUNCTIONS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="parse_dir"
>parse_dir</a></h2>

<pre class="sh_perl">  my $dir = parse_dir( $listing );
  my $dir = parse_dir( $listing, $time_zone );
  my $dir = parse_dir( $listing, $time_zone, $type );
  my $dir = parse_dir( $listing, $time_zone, $type, $error);</pre>

<p>The first argument ($listing) is the directory listing to parse. It can be a scalar, a reference to an array of directory lines or a glob representing a filehandle to read the directory listing from.</p>

<p>The second argument ($time_zone) is used when parsing the time stamps in the listing. If the value is undefined, then the local time zone is assumed.</p>

<p>The third argument ($type) is ignored, but included here for compatibility with <a href="https://alienfile.org/pod/File/Listing.html" class="podlinkpod"
>File::Listing</a>.</p>

<p>The fourth argument ($error) specifies how unparseable lines should be treated. Values can be &#39;ignore&#39;, &#39;warn&#39; or a code reference. &#39;warn&#39; means that the perl <code>warn</code> function will be called. If a code reference is passed, then this routine will be called and the return value from it will be incorporated in the listing. The default is &#39;ignore&#39;.</p>

<p>For each file found in the listing it returns an array ref</p>

<pre class="sh_perl"> foreach my $fileinfo (parse_dir($listing))
 {
   ($name, $type, $size, $mtime, $mode) = @$fileinfo;
   # ...
 }</pre>

<p>The first element ($name) is the name of the file.</p>

<p>The second element ($size) is the size of the file.</p>

<p>The third element ($mtime) is the modification time of the file.</p>

<p>The forth element ($mode) is supposed to be the permission bits of the file, but <code>ftpparse</code> ignores the permission information so this is always undef.</p>

<p>Any field which could not be determined by the algorithm will be <code>undef</code>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="ftpparse"
>ftpparse</a></h2>

<pre class="sh_perl"> my $hash = ftpparse( $line );</pre>

<p>Parse a single line from an FTP listing. Returns a hash ref of information about the file found in that line, or undef if no file information was found about the file.</p>

<p>Here is the information found in the hash ref:</p>

<ul>
<li>name
<p>The name of the file</p>
</li>

<li>size
<p>The size of the file</p>
</li>

<li>sizetype
<p>What format the size refers to, one of</p>

<ul>
<li>SIZE_UNKNOWN
<p>The size could not be determined (size is set to 0)</p>
</li>

<li>SIZE_BINARY
<p>The size assumes a binary transfer (TYPE I)</p>
</li>

<li>SIZE_ASCII
<p>The size assumes an ASCII transfer (TYPE A)</p>

<p>This is currently unused, but could theoretically be used in the future.</p>
</li>
</ul>
</li>

<li>flagtrycwd
<p>0 if the file is definitely not a directory. 1 otherwise.</p>
</li>

<li>flagtryretr
<p>0 if the file is definitely not a regular file or symlink, which can be retrieved. 1 otherwise.</p>
</li>

<li>symlink
<p>If the file is a symlink, then this contains the target name (or at least part of the target name) of the symlink.</p>
</li>

<li>format
<p>The detected format of the listing, one of:</p>

<ul>
<li>FORMAT_UNKNOWN</li>

<li>FORMAT_EPLF</li>

<li>FORMAT_MLSX</li>

<li>FORMAT_LS</li>
</ul>
</li>

<li>mtime
<p>The modification time as the number of non-leap seconds since the epoch.</p>
</li>

<li>mtimetype
<p>Information about the mtime field, one of:</p>

<ul>
<li>MTIME_UNKNOWN
<p>modification time is undetermined</p>
</li>

<li>MTIME_LOCAL
<p>time is correct for the current time zone</p>
</li>

<li>MTIME_REMOTEMINUTE
<p>Time zone and seconds are unknown</p>
</li>

<li>MTIME_REMOTEDAY
<p>Time zone and time of day are unknown</p>
</li>

<li>MTIME_REMOTESECOND
<p>time zone is unknown</p>
</li>
</ul>
</li>
</ul>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CAVEATS"
>CAVEATS</a></h1>

<p>Because <code>ftpparse</code> is written in C and the bindings to it are in XS, so a C compiler is required.</p>

<p>Because <code>ftpparse</code> does not parse out permission information, the mode field is always undef.</p>

<p><code>ftpparse</code> uses a different algorithm, and uses a different interface under the covers, it recognizes a different subset of system listings, and may interpret them differently so this module is not, and does not pretend to be 100% compatible with <a href="https://alienfile.org/pod/File/Listing.html" class="podlinkpod"
>File::Listing</a>.</p>

<p>Internally <code>ftpparse</code> assumes GMT if it can&#39;t determine the time zone from the listing, and doesn&#39;t provide an interface for specifying another time zone if you do happen to know what the remote server&#39;s time zone is. <a href="https://alienfile.org/pod/File/Listing.html" class="podlinkpod"
>File::Listing</a> assumes the listing is for the local time zone unless you specify one through the calling interface. In order to get the expected behavior for <code>parse_dir</code>, this module jumps through some extra hoops to support the <a href="https://alienfile.org/pod/File/Listing.html" class="podlinkpod"
>File::Listing</a> interface. To avoid these hoops use the <code>ftpparse</code> interface instead.</p>

<p>The <code>ftpparse</code> function from <code>ftpcopy</code> is based on <code>ftpparse</code> by Daniel J. Bernsteins. Bernsteins&#39; version is incompatible with GPL, and possibly other open source licenses. The <code>ftpparse</code> function from <code>ftpcopy</code> was written by Uwe Ohse and is mostly public domain, but there was one dependent C source file which was licensed under GPL 2, so I am licensing this whole distribution under GPL 2.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<ul>
<li><a href="https://alienfile.org/pod/File/Listing.html" class="podlinkpod"
>File::Listing</a></li>

<li><a href="http://ohse.de/uwe/ftpcopy/install.html" class="podlinkurl"
>http://ohse.de/uwe/ftpcopy/install.html</a></li>

<li><a href="http://cr.yp.to/ftpparse.html" class="podlinkurl"
>http://cr.yp.to/ftpparse.html</a></li>
</ul>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>C code: Uwe Ohse</p>

<p>XS and Perl code: Graham Ollis &#60;plicease@cpan.org&#62;</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT_AND_LICENSE"
>COPYRIGHT AND LICENSE</a></h1>

<p>Copyright 2002 by Uwe Ohse</p>

<p>Copyright 2013 by Graham Ollis</p>

<p>This is free software, licensed under the GNU General Public License, Version 2, June 1991</p>

<p>Some source files marked as public domain are in the public domain.</p>


    <div class="nx-footer">
      <p>[
        <a href="https://wdlabs.com>wdlabs.com</a>        |
        <a href="https://alienfile.org">alienfile.org</a> |
        <a href="https://pl.atypus.org">pl.atypus.org</a> |
        <a href="https://perlwasm.github.io">perlwasm</a> |
        <a href="https://uperl.github.io">uperl</a>
      ] Copyright &copy; 2022 Graham Ollis</p>
    </div>
  </body>
</html>
